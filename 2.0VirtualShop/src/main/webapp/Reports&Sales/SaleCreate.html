<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<!--  
<link rel="stylesheet" href="/TiendaVirtualNewYork/Letra4.css"
	media="all" />
<link rel="stylesheet" href="/TiendaVirtualNewYork/EstiloTabla.css"
	media="all" />
<link rel="stylesheet" href="/TiendaVirtualNewYork/Letra5.css"
	media="all" />
<link rel="stylesheet" href="/TiendaVirtualNewYork/Letra8.css"
	media="all" />
<link rel="stylesheet" href="/TiendaVirtualNewYork/Titulo2.css"
	media="all" />-->
<title>Registro de Ventas</title>

<script>
	function consultarProducto() {

		var http = new XMLHttpRequest();
		var url = '/TiendaVirtualNewYork/ListSales';
		var params = "";
		http.open('POST', url, true);

		//Send the proper header information along with the request
		http.setRequestHeader('Content-type',
				'application/x-www-form-urlencoded');

		http.onreadystatechange = function() {//Call a function when the state changes.
			if (http.readyState == 4 && http.status == 200) {

				// alert(http.responseText);
				var select = document.getElementById("sltProducts");
				var select1 = document.getElementById("sltProducts1");
				var select2 = document.getElementById("sltProducts2");

				//CreateTableFromJSON(http.responseText);

				var datos = http.responseText;
				datos = datos.replace('[', '').replace(']', '');
				var tokens = datos.split(',');
				for (var i = 0; i < tokens.length; i++) {
					var tokens2 = tokens[i].split(';');
					var id = (tokens2[0].replace('"', ''));
					var name = (tokens2[1].replace('"', ''));
					var price = (tokens2[2].replace('"', ''));

					var el = document.createElement("option");
					el.text = name + ":" + price;
					el.value = id;

					select.add(el);
				}

			}
		}
		http.send(params);
	}

	function validateFields() {
		if (document.getElementById("txtIDcard").value.trim().length == 0
				| document.getElementById("start").value.trim().length == 0
				| document.getElementById("sltProducts").value.trim().length == 0
				| document.getElementById("txtCantidad").value.trim().length == 0
				| document.getElementById("lblTotal").value.trim().length == 0) {
			alert("Los datos de cliente, fecha y una compra deben ser requeridos.");
			return false;
		} else {
			return true;
		}
	}

	function sendData() {
		if (!validateFields()) {
			alert("No se");
			return;
		} else {
			var IdCostumer = document.getElementById("txtIDcard").value.trim();
			var Date = document.getElementById("start").value.trim();
			var IdProduct = document.getElementById("sltProducts").value.trim();
			var Amount = document.getElementById("txtCantidad").value.trim();
			var Tprice = document.getElementById("lblTotal").value.trim();

			alert(IdCostumer, Date, IdProduct, Amount, Tprice)

			var http = new XMLHttpRequest();
			var url = '/TiendaVirtualNewYork/CreateSale';
			var params = "NIT_cliente=" + IdProduct + "&" + "Codigo_producto="
					+ Name + "&" + "cantidad=" + NIT + "&" + "Total=" + PPrice
					+ "&" + "Fecha=" + Fecha;
			http.open('POST', url, true);

			//Send the proper header information along with the request
			http.setRequestHeader('Content-type',
					'application/x-www-form-urlencoded');

			http.onreadystatechange = function() {//Call a function when the state changes.
				if (http.readyState == 4 && http.status == 200) {
					alert(http.responseText);
				}
			}
			http.send(params);
		}
	}

	function updatePrice() {
		var select = document.getElementById("sltProducts");
		var unidades = document.getElementById("txtCantidad");
		var price = select.options[select.selectedIndex].text.split(":")[1];
		// alert(select.options[select.selectedIndex].text);
		alert(price);
		alert(unidades.value);
		var Total = parseFloat(price) * parseFloat(unidades.value);
		document.getElementById("lblTotal").innerText = Total;
	}
</script>
</head>
<body onload="consultarProducto()">
	<br></br>
	<br></br>
	<h1>Registrar Factura</h1>
	<br></br>
	<br></br>

	<table>
		<tr>
			<td>Cédula</td>
			<td><input type="number" class="fondo3" id="txtIDcard"
				name="PurchasePrice"></td>
			<td>
				<button onclick="consultarCliente()" class="btnEffect1">Consultar</button>
			</td>
			<td>Cliente</td>
			<td><label for="lbCliente"></label></td>
			<td><label for="start">Fecha:</label></td>
			<td><input type="date" id="start" name="trip-start"
				value="2018-07-22" min="2021-01-01" max="2118-12-31"></td>
			<td><label for="lbFecha"></label></td>
		</tr>
	</table>
	<br>
	<br>
	<table>
		<tr>
			<td>Cod. Producto</td>
			<td></td>
			<td>Nombre Producto</td>
			<td>Cantidad</td>
			<td>Valor Total</td>

		</tr>

		<tr>

			<td><select id="sltProducts" onchange="updatePrice()"></select>
			<td>
				<button onclick="consultarProducto()" class="btnEffect1">Consultar</button>
			</td>
			<td><label id="NombreProducto"></label></td>
			<td><input type="number" class="fondo3" id="txtCantidad"
				name="PurchasePrice"></td>
			<td><label id="lblTotal"></label></td>

		</tr>

	</table>
	<br></br>
	<button onclick="sendData()" class="btnEffect1">Enviar Datos</button>
	<br></br>
	<button
		onclick="location.href='/TiendaVirtualNewYork/Reports&Sales/Menu.html'"
		class="btnEffect3">Reportes &amp; Ventas</button>

</body>
</html>